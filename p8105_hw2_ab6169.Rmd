---
title: "p8105_hw2_ab6169"
author: "Amrutha Banda"
date: "2025-09-25"
output: github_document
---

## Problem 1

First, I loaded my libraries
```{r setup, include=FALSE}
library(tidyverse)
library(janitor) 
library(readxl)
```

Cleaning the `pols-month.csv` data
```{r message = FALSE}
pols_df= 
  read_csv("data_hw2/pols-month.csv", na = c("NA", ".", "")) |>
  janitor:: clean_names() |> 
separate(mon, into = c("year", "month", "day"), sep = "-") |>
mutate(
  year = as.integer(year),
  month = as.integer(month),
  month = month.name[month],
  president = ifelse(prez_gop == 1|2, "gop", "dem")) |>
  select(-day, -prez_gop, -prez_dem)
```


Cleaning the `snp.csv` data

```{r message = FALSE}
snp_df= 
  read_csv("data_hw2/snp.csv", na = c("NA", ".", ""))|>
  janitor:: clean_names() |> 
  separate(date, into = c("month", "day", "year"), sep = "/") |>
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    month = month.name[month]) |>
  mutate(year=(ifelse(year>25, 1900+year, 2000+year))) |> 
  select(year, month, close, -day) |>
  arrange(year, month)
```

Cleaning the `unemployment.csv` data
```{r message = FALSE}
unemployment_df= 
  read_csv("data_hw2/unemployment.csv", na = c("NA", ".", "")) |>
pivot_longer(
    cols = Jan:Dec,      
    names_to = "month",
    values_to = "unemployment"
  ) |>
  mutate(
    month = case_match(
      month,
      "Jan" ~ "January",
      "Feb" ~ "February",
      "Mar" ~ "March",
      "Apr" ~ "April",
      "May" ~ "May",
      "Jun" ~ "June",
      "Jul" ~ "July",
      "Aug" ~ "August",
      "Sep" ~ "September",
      "Oct" ~ "October",
      "Nov" ~ "November",
      "Dec" ~ "December") ) |> 
  rename(year = Year) |>
  select(year, month, unemployment)
```

Merging `snp.csv` and `pol-month.csv` and `unemployment.csv`
```{r message = FALSE}
merged_df= 
pols_df |>
  left_join(snp_df, by = c("year", "month")) |>
  left_join(unemployment_df, by = c("year", "month"))
```

Write-Up: 

The `pols-month.csv` dataset contains information about political leaders,including the number of governors, senators, and representatives, along with the party of the president at the time. The `snp.csv` dataset provides the closing values of the S&P stock index by year and month. The `unemployment.csv` dataset reports monthly unemployment percentages for each year.  

After cleaning and merging, the resulting dataset has `r nrow(merged_df)` observations, covering the years`r min(merged_df$year)` to `r max(merged_df$year)`. Key variables include `year`, `month`, `president`, `close`, and `unemployment`.  

## Problem 2 

```{r message=FALSE }
mr_trash_df =
  read_excel("data_hw2/trashwheeldatanew.xlsx", 
             sheet= "Mr. Trash Wheel",na= c("NA", ".", "")) |> 
janitor:: clean_names() |> 
drop_na(dumpster) |> 
select(-x15, -x16) |>
 mutate(
  year = as.integer(year),
  sports_balls = as.integer(round(sports_balls)),
  wheel= "Mr.Trash Wheel"
)

prof_trash_df =
  read_excel("data_hw2/trashwheeldatanew.xlsx",
             sheet = "Professor Trash Wheel",
             na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  drop_na(dumpster) |> 
  mutate(
    year = as.integer(year),
    wheel = "Professor Trash Wheel") 


gwynns_df =
  read_excel("data_hw2/trashwheeldatanew.xlsx",
             sheet = "Gwynns Falls Trash Wheel",na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  drop_na(dumpster) |> 
  mutate(
    wheel = "Gwynns Fall Trash Wheel") 

trash_wheel_df =
  bind_rows(mr_trash_df, prof_trash_df, gwynns_df) |>
  janitor:: clean_names() |>
  relocate(wheel, year, month)
```

Write-up 

The Mr. Trash Wheel, Professor Trash Wheel, and Gwynnda datasets track the trash collected from Baltimoreâ€™s harbor. Each row represents a dumpster, with variables for the date, total trash weight, and counts of items such asplastic bottles, cigarette butts, and sports balls.  

After combining all three datasets, the final tidy dataset has `r nrow(trash_wheel_df)` total observations. Key variables include `year`, `month`, `weight_tons`, `cigarette_butts`, and `sports_balls`.  

Professor Trash Wheel has collected a total of `r sum(prof_trash_df$weight_tons, na.rm = TRUE)` tons of trash.In June 2022, Gwynnda collected `r sum(gwynns_df$cigarette_butts[gwynns_df$month == "June" & gwynns_df$year == 2022], na.rm = TRUE) `cigarette butts.




## Problem 3 

```{r message = FALSE}
zipcodes_df= 
  read_csv("data_hw2/zipcodes.csv", na = c("NA", ".", "")) |>
  janitor::clean_names() |> 
  select(-state_fips, -file_date) 

zori_df = 
  read_csv("data_hw2/zipnyc.csv", na = c("NA", ".", "")) |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = starts_with("x20"),
    names_to = "date",
    values_to = "zori"
  ) |> 
  rename(
    zip_code= region_name) |> 
  mutate(county_name= str_remove(county_name, " County")) |> 
  rename(county= county_name) |> 
  select(-city, -metro, -region_type, -state_name, -state, ) |> 
  mutate(date = sub("^x", "", date))

#Joined DataFrame
mergezip_df=
  left_join(zipcodes_df, zori_df, by = c("zip_code","county")) 
```

Writeup: 
I cleaned and merged the Zillow Observed Rent Index (zori) dataset with the ZIP code information. From this, I got a single tidy dataset, `mergezip_df`. The final dataset has `r nrow(mergezip_df)` total observations. There are  `r n_distinct(mergezip_df$zip_code)` unique zipcodes included. There are `r n_distinct(mergezip_df$neighborhood)` unique neighborhoods. Many rows of the ZORI dataset contain missing values because Zillow did not report rent for those ZIP codes or months

```{r message = FALSE}
#Shows which ZIP codes appear in the ZIP code dataset but not in the Zillow Rental Price dataset
missing_zips_df =
  anti_join(zipcodes_df, zori_df, by = "zip_code","county")
```

Illustrative Examples:

These zipcodes might be excluded from the Zillow dataset for various reason. For example, zipcode 10112 covers Rockefeller Center and office towers so Zillow cannot track rents if they don't have residential rental markets. Zipcode 10048 could be excluded since it is the one and only valid zip code for any Tennant and office located in the original World Trade Center complex. So, it is assigned for historical or institutional use and not for active housing. Lastly, 


```{r}
covid_change_df =
  mergezip_df |>
  filter(date %in% c("2020_01_31", "2021_01_31")) |>
  select(zip_code, county, neighborhood, date, zori) |>
  pivot_wider(
    names_from = date,
    values_from = zori,
    names_prefix = "year_"
  ) |>
  mutate(change = year_2021_01_31 - year_2020_01_31) |>
  drop_na(change)

top_ten_change= 
  covid_change_df |>
  arrange(change) |>       
  slice_head(n = 10) |>         
  select(zip_code, county, neighborhood, year_2020_01_31, year_2021_01_31, change)
```

Comments: 
The `covid_change_df` compares ZORI rental prices in January 2020 and January 2021 for all available NYC ZIP codes. The dataset has `r nrow(covid_change_df)` observations. Each showing the rent change across one ZIP code. The largest rent decrease was `r min(covid_change_df$change, na.rm = TRUE)` while the largest increase was `r max(covid_change_df$change, na.rm = TRUE)`. This highlights the fluctuations in rental prices during the COVID-19 pandemic.  


